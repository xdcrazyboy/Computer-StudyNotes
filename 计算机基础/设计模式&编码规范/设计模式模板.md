
# 单例模式

## 双重否定

```java

public class Singleton {
    private static volatile Singleton instance = null;

    private Singleton() {};

    public static getSingleInstance() {
        if(instance == null) {
            synchronized(Singleton.class) {
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}

```

## 内部静态类

利用内部类持有静态对象的方式实现。

**理论**： 对象初始化过程中隐含的初始化锁


```java
public class Singleton {
    private Singleton(){}
    public static Singleton getSingleton(){
        return Holder.singleton;
    } 
    private static class Holder {
        private static Singleton singleton = new Singleton();
    }

}
```

## 实际一些简单的实现
Java 核心类库自己的 单例实现，比如java.lang.Runtime：

```java
private static final Runtime currentRuntime = new Runtime();
private static Version version;
 // ...
public static Runtime getRuntime() {
    return currentRuntime;
}
 /** Don't let anyone else instantiate this class */ 8
```

静态实例被声明为 final，这是被通常实践忽略的，一定程度保证了实例不被篡改，也有有限的保证执行顺序的语义。                                                                                                                                                                                                                                                                                                                                                                                                                              


# 策略模式

```java
//定义
public abstract class RouterHandler {
    protected RouterHandler next;

    public void setNext(RouterHandler next) {
        this.next = next;
    }

    public abstract RouterResponse doHandler(RouterContext context);

    public static class Builder {
        private RouterHandler head;
        private RouterHandler tail;

        public Builder addChain(RouterHandler chain) {
            if(this.head == null) {
                this.head = this.tail = chain;
                return this;
            }
            this.tail.setNext(chain);
            this.tail = chain;
            return this;
        }

        public RouterHandler build() {
            return this.head;
        }
    }
}

// 实现类
public class DirectQueryDBRouterHandler extends RouterHandler {

    private static final Logger logger = LoggerFactory.getLogger(DirectQueryDBRouterHandler.class);

    @Override
    public RouteResponse doHandler(ClusterRouterContext context) {
        boolean bool = context.getBool();
        if (bool) {
            return this.next.doHandler(context);
        }

        RouteResponse response = new RouteResponse();
        ...
        return response;
    }
}


// 初始化
RouterHandler routerHandler = new RouterHandler.Builder()
                .addChain(new DirectQueryDBRouterHandler())
                .addChain(new SpecifyClusterRouterHandler())
                .build();

// 调用
RouteResponse response = routerHandler.doHandler(context);

```