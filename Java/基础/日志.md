
# 日志
记录系统日志的三大原因：
1. 记录操作轨迹
2. 监控系统运行状况
3. 回溯系统故障

## 日志规范

1. 日志命名：推荐的日志文件命名方式为 appName_logType logName.log。 其中 ， logType 为 日志类型，推荐分类有 stats、 monitor、 visit 等 ， logName 为日志描述。这种命名的 好处是: 通过文件名就可以知道曰志文件属于什么应用，什么类型，什么目的，也有利 于归类查找。例如， mppserver 应用中单独监控时区转换异常的日志文件名定义为
`mppserver_monitor_timeZoneConvert.log`。

2. 日志保存多久？代码规约推荐曰志文件**至少保存15天**，可以根据日志文件的重要程度、 文件大小及磁盘空间再自行延长保存时间。
3. 生产环境禁止输出 DEBUG 曰志旦有选择地输出 INFO日志。 
4. ERROR 级别只记录系统逻辑错误、异常或者违反重要的业务规则，其他错误都可以归为 WARN 级别。用户输入参数错误，这种WARN记录下，方便用户咨询时能还原现场就行。 如果输入ERROR就需要人工介入，显然是不合理的。
5. 确保记录内容完整： 异常堆栈e一定要输出。 输出对象实例时，要确保实例类重写了toString方法，不然只是输出对象的hashCode值，没有实际意义。

记录日志时要考虑三个问题：
 - 日志是否有人看
 - 看到这条日志能做什么
 - 能不能提升问题排查效率。

## 日志框架
log4j、logback、jdk-logging、slf4j、commons-logging等，一般可分为三大部分：
- 日志门面
- 日志适配器
- 日志库



# Log4j2详解

## XML配置详解

**配置文件的加载顺序**
- 优先查找 log4j.configurationFile 系统属性所指定的配置文件名。
  - 通过在代码中调用 System.setProperties("log4j.configurationFile","FILE_PATH") 
  - 将 -Dlog4jconfigurationFile=file://C:/configuration.xml 参数传递给 JVM；

- 先查找test测试配置文件，在 classpath 中寻找 log4j2-test.properties 配置文件；
  - 按照properties->yaml->json->xml的优先顺序去找。如果存在两个，从前到后，用最先的那个
- 如果没找到带test的配置文件，就找log4j2.properties， 也是按照上面文件格式优先级找。
- 如果还没找到，就使用默认的DefaultConfiguration 配置。


**默认配置：**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="WARN">
  <Appenders>
    <!-- 默认打印到控制台 -->
    <Console name="Console" target="SYSTEM_OUT">
       <!-- 默认打印格式 -->
      <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/>
    </Console>
  </Appenders>
  <Loggers>
     <!-- 默认打印日志级别为 error -->
    <Root level="error">
      <AppenderRef ref="Console"/>
    </Root>
  </Loggers>
</Configuration>
```


**热更新日志配置**
>通过设置 Configuration 元素的 monitorInterval 属性值（秒数）为一个非零值来让 Log4j 每隔指定的秒数来重新读取配置文件，可以用来动态应用 Log4j 配置。 
```xml
<?xml version="1.0" encoding="UTF-8"?>
<Configuration monitorInterval="30">
...
</Configuration>
```


