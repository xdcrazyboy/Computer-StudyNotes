

# 了解索引


## 1. 索引分类

- 按数据结构分类可分为：B+tree索引、Hash索引、Full-text索引。
- 按物理存储分类可分为：聚簇索引、二级索引（辅助索引）。
* 按字段特性分类可分为：主键索引、普通索引、前缀索引。
* 按字段个数分类可分为：单列索引、联合索引（复合索引、组合索引）。


## 2. 设计原则

* **索引并非越多越好**，一个表中如有大量的索引，不仅占用磁盘**空间**，还会影响INSERT、DELETE、UPDATE等语句的性能，因为在表中的数据更改时，索引也会进行调整和更新。**耗时，降低更新性能**
* 避免对经常更新的表进行过多的索引，并且索引中的列要尽可能少。应该经常用于查询的字段创建索引，但要避免添加不必要的字段。
* 数据量小的表最好不要使用索引，由于数据较少，查询花费的时间可能比遍历索引的时间还要短，索引可能不会产生优化效果。
* 在条件表达式中经常用到的不同值较多的列上建立索引，在不同值很少的列上不要建立索引。比如在学生表的“性别”字段上只有“男”与“女”两个不同值，因此就无须建立索引，如果建立索引不但不会提高查询效率，反而会严重降低数据更新速度。
* 当唯一性是某种数据本身的特征时，指定唯一索引。使用唯一索引需能确保定义的列的数据完整性，以提高查询速度。
* 在频繁进行排序或分组（即进行group by或order by操作）的列上建立索引，如果待排序的列有多个，可以在这些列上建立组合索引。


## 3. 高频索引问题

### 联合索引


### 覆盖索引

即从辅助索引中就可以得到查询的字段，就不需要再查询聚集索引中的记录(回表查询)。 比如只取Id

使用覆盖索引的好处是辅助索引不包含整行记录的所有信息，故其大小要远小于聚集索引，因此可以减少大量的IO操作。 

所以要求我们尽量查找指定字段，避免回表。


### 最左匹配原则

一般来说对于诸如（a，b）这样的联合索引，一般不可以选择b列作为查询条件。但是对于统计操作，如果是覆盖索引的，则优化器会进行选择。

### 聚集索引和辅助索引的区别

聚集索引与辅助索引，底层数据结构都是B+树，区别仅在于所存放数据的内容:

- 聚集索引是根据主键创建的一棵B+树，聚集索引的**叶子节点存放了表中的所有记录**。（回表一般就是说回到聚集索引？）
- 辅助索引是根据索引键创建的一棵B+树，与聚集索引不同的是，其叶子节点仅存放索引键值，以及该索引键值指向的主键。 （覆盖索引就是直接在辅助索引得到了需要返回的字段，不再回表？）


## B+树索引

### 介绍

在数据库中，B+树的高度一般都在2～4层，这意味着查找某一键值最多只需要2到4次IO操作，这还不错。因为现在一般的磁盘每秒至少可以做100次IO操作，2～4次的IO操作意味着查询时间只需0.02～0.04秒


B+树的键值为主键，若在建立时没有显式地指定主键，**则InnoDB存储引擎会自动创建一个6字节的列作为主键(rowId)**。


### MyISAM B+树索引
MyISAM存储引擎其实更像一张堆表，其特点整理如下:

所有的行数据都存放于MYD文件中，
其B+树索引都是辅助索引，存放于MYI文件中。
主键索引和其他索引不同之处在于其必须是唯一的，并且不可为NULL值。
其索引页的大小默认为1KB，同样不可以进行调整。
与InnoDB存储引擎不同的是，因为没有聚集索引，其索引叶节点存放的键值不是主键值，而是在MYD文件中的物理位置。


# 参考文档
- http://liuqh.icu/2021/10/25/db/03-mysql-index/