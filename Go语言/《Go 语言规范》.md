[TOC]
# 如何写出优雅的Go代码

## Go语言规范

- [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments)
- [《Effective Go》](https://go.dev/doc/effective_go)


### 腾讯规约

#### 不符合个人习惯的点
**特别不符合**


- xxx



**一般不符合**


- 作为**输入参数**或者数组下标时，运算符和运算数之间不需要空格，紧凑展示。

#### import规范
* 对包进行分组管理，通过空行隔开，默认分为本地包（标准库、内部包）、第三方包。
* 标准包永远位于最上面的第一组。
* 内部包是指不能被外部 import 的包，如 GoPath 模式下的包名或者非域名开头的当前项目的 GoModules 包名。
* **带域名**的包名都属于第三方包，如 git.code.oa.com/xxx/xxx，github.com/xxx/xxx，**不用区分是否是当前项目内部**的包。
* goimports 默认最少分成本地包和第三方包两大类，这两类包必须分开不能放在一起。本地包或者第三方包内部可以继续按实际情况细分不同子类。

- 不要使用相对路径引入包
- 匿名包的引用建议使用一个新的分组引入，并在匿名包上写上注释说明。

#### error处理
- error 必须是最后一个参数
- 错误描述不需要标点结尾。
- 判断错误不要if-else，直接用卫语句一个if搞定。 而且需要单独处理，不与其他变量组合逻辑判断。
```go
// 不要采用这种方式：
x, y, err := f()
if err != nil || y == nil {
    return err   // 当y与err都为空时，函数的调用者会出现错误的调用逻辑
}
```
* 【推荐】对于不需要格式化的错误，生成方式为：errors.New("xxxx")。
* 【推荐】建议go1.13 以上，error 生成方式为：fmt.Errorf("module xxx: %w", err)。


### 最佳实践

#### 包
>如何设计包，包括包的名称，命名类型以及编写方法和函数的技巧

- 在项目中，每个包名称应该是唯一的。包的名称应该描述其目的的建议很容易理解 - 如果你发现有两个包需要用相同名称，它可能是:
  - 包的名称太通用了。
  - 该包与另一个类似名称的包重叠了。在这种情况下，您应该检查你的设计，或考虑合并包。


- 避免使用类似 base， common或 util的包名称
  -  一些帮助程序和工具类的包，由于这些包包含各种不相关的功能，因此很难根据包提供的内容来描述它们。
  -  像 utils或 helper这样的包名称通常出现在较大的项目中，这些项目已经开发了深层次包的结构，并且希望在不遇到导入循环的情况下共享 helper函数。
  -  如果可能的话，将相关的函数移动到调用者的包中。即使这涉及复制一些 helper程序代码，这也比在两个程序包之间引入导入依赖项更好。
  > [一点点] 重复比错误的抽象的性价比高很多。


#### 项目结构
- 除 cmd/和 internal/之外的每个包都应包含一些源代码。
- 尽量选择更少、更大的包
  - 如果您来自 Java或 C#，请考虑这一经验法则
    -  Java包相当于单个 .go源文件。 
    - Go 语言包相当于整个 Maven模块或 .NET程序集。

- 什么时候应该将 .go文件拆分成多个文件？什么时候应该考虑整合 .go文件？
  
  * 开始时使用一个 .go文件。为该文件指定与文件夹名称相同的名称。例如: package http应放在名为 http的目录中名为 http.go的文件中。

  * 随着包的增长，您可能决定将各种职责任务拆分为不同的文件。例如， messages.go包含 Request和 Response类型， client.go包含 Client类型， server.go包含 Server类型。

  * 如果你的文件中 import的声明类似，请考虑将它们组合起来。或者确定 import集之间的差异并移动它们。

  * 不同的文件应该负责包的不同区域。 messages.go可能负责网络的 HTTP请求和响应， http.go可能包含底层网络处理逻辑， client.go和 server.go实现 HTTP业务逻辑请求的实现或路由等等。


#### API设计



---

## 腾讯 Protobuf 代码规范
Protobuf作为服务数据接口的重要组成部分，某种程度上对其正确性和稳定性的**要求比对功能代码本身还高**。


---
## Go Mod 开发&发布公约
